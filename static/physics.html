<!DOCTYPE html>
<html lang="en">
	<head>
		<title>AFrame Demo</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script src="./third-party/aframe.min.js"></script>
		<script src="./third-party/aframe-environment-component.js"></script>
		<script src="./third-party/aframe-physics-system.min.js"></script>
		<script src="./helpers/avatar-helper-components.js"></script>
		<script src="./dist/fast-sync-component.js"></script>
	</head>
	<body>

	<a-scene physics="debug: true;">
		<a-assets>
			<a-asset-item id="student-obj" src="https://ada.is/vr-ada/assets/student/student.obj"></a-asset-item>
			<a-asset-item id="student-mtl" src="https://ada.is/vr-ada/assets/student/student.mtl"></a-asset-item>
		</a-assets>

		<a-entity environment="shadow: true; shadowSize: 10; preset: threetowers;" ></a-entity>

		<a-entity id="avatar-template" visible="false" obj-model="obj: #student-obj; mtl: #student-mtl" student-model shadow="receive: false;"></a-entity>
		<a-entity id="avatar" clone="#avatar-template" visible="false" scale="0.5 0.5 0.5"></a-entity>

		<a-entity circle-around="radius: 6; origin: 0 0 0;">
			<a-camera rotation="0 180 0" fast-sync="copy: #avatar; world: true; components: clone;"></a-camera>
		</a-entity>
	</a-scene>	


	<script type="text/html" id="demo1">
		<a-box id="spinner" position="0 4 0" shadow="receive: false;" fast-sync>
			<a-animation from="0 0 0" to="0 90 0" repeat="indefinite" easing="linear" end="stolen"></a-animation> 
		</a-box>
	</script>

	<script type="text/html" id="demo2">
		<a-entity id="floor" position="0 -0.2 0" geometry="primitive: plane; width: 20; height: 20;" visible="false" rotation="-90 0 0" position="0 -0.2 0" static-body></a-entity>
		<a-box fast-sync shadow="receive: false;" material="color: blue;" position="0 0.4 0" dynamic-body="mass:1;"></a-box>
		<a-box fast-sync shadow="receive: false;" material="color: green;" position="-1.2 0.4 0" dynamic-body="mass:1;"></a-box>
		<a-box fast-sync shadow="receive: false;" material="color: yellow;" position="1.2 0.4 0" dynamic-body="mass:1;"></a-box>
		<a-box fast-sync shadow="receive: false;" material="color: crimson;" position="-0.55 1.5 0" dynamic-body="mass:1;"></a-box>
		<a-box fast-sync shadow="receive: false;" material="color: purple;" position="0.55 1.5 0" dynamic-body="mass:1;"></a-box>
		<a-box fast-sync shadow="receive: false;" material="color: orange;" position="0 2.6 0" dynamic-body="mass:1;"></a-box>
		<a-sphere fast-sync position="0 0.5 -8" radius="0.5" dynamic-body="mass: 20;" id="ball"></a-sphere>
	</script>

	<script>
		if (document.location.search === '?stuff') {
			document.querySelector('a-scene').insertAdjacentHTML('beforeend', window.demo2.textContent);

			// Throw ball to demo physics
			setTimeout(function() {
				var el = document.querySelector('#ball');
				el.body.applyImpulse(
					new CANNON.Vec3(0, 60, 400),
					new CANNON.Vec3().copy(el.getAttribute('position'))
				);
			}, 5000);

			// steal rotating cube, make it rotate in the opposite direction
			setTimeout(function() {
				var spinner = document.querySelector('#spinner');
				spinner.components['fast-sync-listener'].steal().then(function () {
					console.log('Steal complete');
					spinner.insertAdjacentHTML('beforeend', '<a-animation from="0 0 0" to="0 -90 0" repeat="indefinite" easing="linear"></a-animation>')
				});
			}, 7000);
		} else {
			document.querySelector('a-scene').insertAdjacentHTML('beforeend', window.demo1.textContent);
		}
	</script>
	</body>
</html>